<% layout('@layouts/layout.html', {page_title: "Início" }) %>

<section x-data="{
    activeSlide: 0,
    slides: [
        {
            image: 'https://i.imgur.com/pUawD0d.png',
            title: 'Programa de afiliados',
            description: 'Ganhe até 10% de todos os depósitos quando seus afiliados estiverem usando seu código',
            buttonText: 'Vamos',
            buttonLink: 'https://seusite.com/afiliados'
        },
        {
            image: 'https://i.imgur.com/w5KScMi.png',
            title: 'Ofertas Imperdíveis!',
            description: 'Confira nossas promoções exclusivas e economize muito.',
            buttonText: 'Ver Ofertas',
            buttonLink: 'https://seusite.com/ofertas'
        }
    ],
    init() {
        // Troca automática dos slides a cada 6 segundos
        setInterval(() => {
            this.activeSlide = (this.activeSlide + 1) % this.slides.length;
        }, 6000);
    }
}" class="relative bg-black overflow-hidden group py-8">

    <div class="container mx-auto px-4">
        <div class="relative overflow-hidden rounded-2xl w-full h-[200px] sm:h-[300px] md:h-[400px] lg:h-[500px]">
            <template x-for="(slide, index) in slides" :key="index">
                <div
                    x-show="activeSlide === index"
                    x-transition:enter="transition ease-out duration-1000"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="transition ease-in duration-1000"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    class="absolute inset-0 bg-center bg-cover"
                    :style="'background-image: url(' + slide.image + ')'"
                >
                    <div class="absolute inset-0 bg-black/50"></div>

                    <div class="relative z-10 flex items-end h-full p-4 sm:p-8 lg:p-12">
                        <div class="text-white max-w-lg mb-4">
                            <h2 class="hidden md:block text-3xl sm:text-4xl md:text-5xl font-bold mb-2 sm:mb-4" x-text="slide.title"></h2>
                            <p class="hidden md:block text-base sm:text-lg mb-4 sm:mb-6" x-text="slide.description"></p>
                            
                            <a :href="slide.buttonLink" 
                               class="inline-flex items-center px-6 py-3 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-semibold transition duration-300 shadow-lg 
                                     bg-zinc-900/80 md:bg-purple-600 md:shadow-lg md:border-none md:p-3 md:rounded-lg">
                                <i data-lucide="gem" class="size-5 mr-2"></i>
                                <span x-text="slide.buttonText"></span>
                            </a>
                        </div>
                    </div>
                </div>
            </template>

            <button @click="activeSlide = (activeSlide - 1 + slides.length) % slides.length"
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-zinc-800/60 p-2 rounded-full hover:bg-zinc-700 transition duration-300 backdrop-filter backdrop-blur-sm shadow-lg opacity-0 hover:opacity-100 focus:opacity-100 group-hover:opacity-100 z-20">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"/></svg>
            </button>
            <button @click="activeSlide = (activeSlide + 1) % slides.length"
                    class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-zinc-800/60 p-2 rounded-full hover:bg-zinc-700 transition duration-300 backdrop-filter backdrop-blur-sm shadow-lg opacity-0 hover:opacity-100 focus:opacity-100 group-hover:opacity-100 z-20">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"/></svg>
            </button>

            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-20">
                <template x-for="(slide, index) in slides" :key="index">
                    <button @click="activeSlide = index"
                            :class="{ 'bg-purple-600': activeSlide === index, 'bg-zinc-400': activeSlide !== index }"
                            class="w-3 h-3 rounded-full transition-colors duration-300">
                    </button>
                </template>
            </div>
        </div>
    </div>
</section>

<section class="relative container mx-auto px-4 py-8 pt-0 z-20 md:static">
    <div class="flex overflow-x-auto gap-4 pb-4 custom-scrollbar-hide md:grid md:grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 md:gap-4 md:pb-0">
        <div class="flex-shrink-0 w-[80vw] sm:w-[45vw] md:w-auto bg-zinc-800 rounded-xl p-4 flex items-center gap-4 shadow-lg border border-zinc-700 mx-1 my-2 md:mx-0 md:my-0">
            <div class="bg-blue-600 p-3 rounded-full flex-shrink-0">
                <i data-lucide="shield-check" class="size-6 text-white"></i>
            </div>
            <div>
                <h5 class="text-white text-base font-semibold mb-1">Garantia</h5>
                <p class="text-zinc-300 text-sm">Entrega garantida ou seu dinheiro de volta.</p>
            </div>
        </div>
        <div class="flex-shrink-0 w-[80vw] sm:w-[45vw] md:w-auto bg-zinc-800 rounded-xl p-4 flex items-center gap-4 shadow-lg border border-zinc-700 mx-1 my-2 md:mx-0 md:my-0">
            <div class="bg-blue-600 p-3 rounded-full flex-shrink-0">
                <i data-lucide="headphones" class="size-6 text-white"></i>
            </div>
            <div>
                <h5 class="text-white text-base font-semibold mb-1">Suporte</h5>
                <p class="text-zinc-300 text-sm">Atendimento rápido e eficiente.</p>
            </div>
        </div>
        <div class="flex-shrink-0 w-[80vw] sm:w-[45vw] md:w-auto bg-zinc-800 rounded-xl p-4 flex items-center gap-4 shadow-lg border border-zinc-700 mx-1 my-2 md:mx-0 md:my-0">
            <div class="bg-blue-600 p-3 rounded-full flex-shrink-0">
                <i data-lucide="badge-check" class="size-6 text-white"></i>
            </div>
            <div>
                <h5 class="text-white text-base font-semibold mb-1">Compra Segura</h5>
                <p class="text-zinc-300 text-sm">Transações protegidas e confiáveis.</p>
            </div>
        </div>
        <div class="flex-shrink-0 w-[80vw] sm:w-[45vw] md:w-auto bg-zinc-800 rounded-xl p-4 flex items-center gap-4 shadow-lg border border-zinc-700 mx-1 my-2 md:mx-0 md:my-0">
            <div class="bg-blue-600 p-3 rounded-full flex-shrink-0">
                <i data-lucide="tag" class="size-6 text-white"></i>
            </div>
            <div>
                <h5 class="text-white text-base font-semibold mb-1">Melhores Preços</h5>
                <p class="text-zinc-300 text-sm">Ofertas imperdíveis para você!</p>
            </div>
        </div>
    </div>
</section>

<div class="space-y-12 py-4 bg-zinc-950">
    <% categories.forEach(category => { %>
        <section id="category-section" data-category-id="<%= category.id %>" class="container mx-auto px-4">
            <h4 class="relative flex items-center justify-center text-center text-white text-lg md:text-xl font-semibold mb-8">
                <span class="flex-grow border-t border-zinc-700"></span>
                <span class="flex-shrink-0 px-4 bg-zinc-950 z-10">
                    <%= category.title %>
                </span>
                <span class="flex-grow border-t border-zinc-700"></span>
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4" id="products-list">
                <%
                    // Simulando uma lista de produtos para cada categoria se 'products' não estiver disponível globalmente
                    const dummyProducts = [
                        {
                            info: { title: "The Last of Us™ Part II Remastered", mainImage: "https://i.imgur.com/V9r112t.jpeg", slug: "the-last-of-us-part-2-remastered" },
                            categoryName: "PlayStation", inventory: { hasStock: true, stockCount: 13 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 24.90, oldPrice: null, discount: null }
                        },
                        {
                            info: { title: "Elden Ring Nightreign", mainImage: "https://i.imgur.com/D8j5mR1.jpeg", slug: "elden-ring-nightreign" },
                            categoryName: "PC", inventory: { hasStock: true, stockCount: 27 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 26.90, oldPrice: null, discount: null }
                        },
                        {
                            info: { title: "Stellar Blade", mainImage: "https://i.imgur.com/x0X3xYx.jpeg", slug: "stellar-blade" },
                            categoryName: "PlayStation", inventory: { hasStock: true, stockCount: 25 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 34.90, oldPrice: null, discount: null }
                        },
                        {
                            info: { title: "The Witcher 3: Wild Hunt - Edição Completa", mainImage: "https://i.imgur.com/WjwfRr9.jpeg", slug: "the-witcher-3" },
                            categoryName: "Steam", inventory: { hasStock: true, stockCount: 25 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 29.90, oldPrice: 59.90, discount: 50 }
                        },
                        {
                            info: { title: "Cyberpunk 2077: Phantom Liberty", mainImage: "https://i.imgur.com/53zOHjO.png", slug: "cyberpunk-2077" },
                            categoryName: "Epic Games", inventory: { hasStock: true, stockCount: 15 }, isAutoDelivery: false, type: "DEFAULT",
                            pricing: { price: 39.90, oldPrice: null, discount: null }
                        },
                        {
                            info: { title: "Baldur's Gate 3 - Digital Deluxe", mainImage: "https://i.imgur.com/WjwfRr9.jpeg", slug: "baldurs-gate-3" },
                            categoryName: "GOG.com", inventory: { hasStock: false, stockCount: 0 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 99.90, oldPrice: null, discount: null }
                        },
                        {
                            info: { title: "Starfield Edição Premium", mainImage: "https://i.imgur.com/53zOHjO.png", slug: "starfield" },
                            categoryName: "Xbox Game Pass", inventory: { hasStock: true, stockCount: 50 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 79.90, oldPrice: 119.90, discount: 33 }
                        },
                        {
                            info: { title: "FIFA 25 Ultimate Edition", mainImage: "https://i.imgur.com/WjwfRr9.jpeg", slug: "fifa-25" },
                            categoryName: "Origin", inventory: { hasStock: true, stockCount: 100 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 49.90, oldPrice: null, discount: null }
                        },
                           {
                            info: { title: "Forza Horizon 5", mainImage: "https://i.imgur.com/53zOHjO.png", slug: "forza-horizon-5" },
                            categoryName: "Xbox", inventory: { hasStock: true, stockCount: 70 }, isAutoDelivery: true, type: "DEFAULT",
                            pricing: { price: 34.90, oldPrice: null, discount: null }
                        }
                    ];
                    // Para uso real, substitua 'dummyProducts' por 'category.products' ou sua variável de produtos real
                    dummyProducts.forEach(product => {
                %>
                    <a class="group relative bg-zinc-800 rounded-xl overflow-hidden flex flex-col shadow-lg border border-zinc-700 hover:border-purple-600 transition-all duration-300 h-full" href="/products/<%= product.info.slug %>">
                        <div class="absolute inset-0 bg-cover bg-center opacity-20 blur-xs group-hover:opacity-40 transition-opacity duration-300 z-0"
                            style="background-image: url('<%= product.info.mainImage %>');">
                        </div>

                        <% if (!product.inventory.hasStock) { %>
                        <div class="absolute inset-0 bg-black/80 flex items-center justify-center font-semibold text-white z-20 rounded-xl">
                            <i data-lucide="circle-x" class="size-6 mr-2"></i>
                            Esgotado
                        </div>
                        <% } %>

                        <div class="p-3 sm:p-4 flex flex-col h-full relative z-10">
                            <div class="flex items-start gap-3 mb-2 sm:mb-3">
                                <img alt="<%= product.info.title %>" width="60" height="60" class="w-14 h-14 sm:w-16 sm:h-16 object-cover rounded-md shadow-md flex-shrink-0" src="<%= product.info.mainImage %>" />
                                
                                <div class="flex-1">
                                    <h4 class="text-sm sm:text-base font-semibold text-white mb-0.5 line-clamp-2"><%= product.info.title %></h4>
                                    
                                    <div class="flex flex-wrap items-center gap-1">
                                        <%
                                            let iconUrl = '';
                                            let categoryText = product.categoryName || 'Geral'; // Fallback para "Geral"
                                            
                                            // Lógica para mapear categoria para ícone
                                            switch(categoryText.toLowerCase()) {
                                                case 'steam':
                                                case 'jogos steam':
                                                case 'pc':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/8/83/Steam_icon_logo.svg';
                                                    break;
                                                case 'xbox':
                                                case 'jogos xbox':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/d/d7/Xbox_Game_Pass.svg';
                                                    break;
                                                case 'playstation':
                                                case 'jogos playstation':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/3/3a/PlayStation_Plus_logo.svg';
                                                    break;
                                                case 'origin':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/c/c5/Origin_%28platform%29_logo.svg';
                                                    break;
                                                case 'epic games':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/a/a7/Epic_Games_logo.svg';
                                                    break;
                                                case 'uplay':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/0/07/Ubisoft_Connect_Logo.svg';
                                                    break;
                                                case 'nintendo':
                                                case 'nintendo eshop':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Nintendo_eShop_logo.svg/2048px-Nintendo_eShop_logo.svg.png';
                                                    break;
                                                case 'gog':
                                                case 'gog.com':
                                                    iconUrl = 'https://upload.wikimedia.org/wikipedia/commons/2/2c/GOG.com_logo.svg';
                                                    break;
                                                case 'ação':
                                                case 'aventura':
                                                case 'rpg':
                                                case 'esportes':
                                                case 'corrida':
                                                case 'aventura espacial':
                                                    iconUrl = 'https://lucide.dev/icons/gamepad.svg';
                                                    break;
                                                case 'multiplataforma':
                                                    iconUrl = 'https://lucide.dev/icons/gamepad.svg';
                                                    break;
                                                default:
                                                    iconUrl = 'https://lucide.dev/icons/tag.svg';
                                            }
                                        %>
                                        <% if (iconUrl) { %>
                                            <% if (iconUrl.includes('lucide.dev/icons')) { %>
                                                <i data-lucide="<%= iconUrl.split('/').pop().replace('.svg', '') %>" class="size-3.5"></i>
                                            <% } else { %>
                                                <img src="<%= iconUrl %>" alt="Ícone <%= categoryText %>" class="w-3.5 h-3.5 object-contain">
                                            <% } %>
                                        <% } %>
                                        <span class="px-1 py-0.5 bg-zinc-700 text-zinc-300 text-xs rounded"><%= categoryText %></span>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col gap-1 mb-2 sm:mb-3">
                                <% if (product.isAutoDelivery) { %>
                                <div class="inline-flex items-center gap-1 bg-blue-700/30 text-blue-300 px-2.5 py-0.5 rounded-full text-xs font-medium">
                                    <i data-lucide="zap" class="size-3.5 mr-0.5"></i> Envio Automático
                                </div>
                                <% } %>
                                <span class="text-xs text-zinc-400"><%= product.inventory.stockCount %> Disponíveis</span>
                            </div>

                            <hr class="border-t border-dashed border-zinc-600 mb-2 sm:mb-3">

                            <div class="flex items-center justify-between mt-auto"> <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 sm:w-7 sm:h-7 rounded-full bg-white flex items-center justify-center border border-zinc-600 flex-shrink-0">
                                        <span class="text-zinc-900 font-bold text-xs">N</span> </div>
                                </div>
                                <div class="text-right">
                                    <% if (product.type === "DEFAULT" && product.pricing.discount !== null) { %>
                                    <del class="text-zinc-500 text-xxs sm:text-xs block"><%= formatPrice(product.pricing.oldPrice) %></del>
                                    <% } %>
                                    <span class="text-sm sm:text-lg font-bold text-white"><%= product.type === "DEFAULT" ? formatPrice(product.pricing.price) : `${formatPrice(product.pricing.from)}+` %></span>
                                </div>
                            </div>
                        </div>
                    </a>
                    <% }); %>
            </div>
        </section>
    <% }) %>
</div>

<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
<script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>
<script>
    lucide.createIcons();
</script>

<style>
    /* Custom scrollbar hide for product carousels */
    .custom-scrollbar-hide::-webkit-scrollbar {
        display: none; /* For Chrome, Safari, and Opera */
    }

    .custom-scrollbar-hide {
        -ms-overflow-style: none; /* For Internet Explorer and Edge */
        scrollbar-width: none; /* For Firefox */
    }

    /* For a smoother snapping effect on scroll */
    .scroll-snap-x.mandatory {
        scroll-snap-type: x mandatory;
    }

    .scroll-snap-align-start {
        scroll-snap-align: start;
    }

    /* Custom blur class for slight blur */
    .blur-xs {
        filter: blur(2px); /* Adjust value as needed for a subtle blur */
    }
    .text-xxs {
        font-size: 0.6rem; /* Um tamanho um pouco menor que xs */
    }
</style>